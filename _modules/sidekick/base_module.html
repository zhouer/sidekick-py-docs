

<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../../">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>sidekick.base_module &mdash; Sidekick Python Library 0.0.3 documentation</title>
      <link rel="stylesheet" type="text/css" href="../../_static/pygments.css?v=b86133f3" />
      <link rel="stylesheet" type="text/css" href="../../_static/css/theme.css?v=e59714d7" />

  
      <script src="../../_static/jquery.js?v=5d32c60e"></script>
      <script src="../../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
      <script src="../../_static/documentation_options.js?v=47de8214"></script>
      <script src="../../_static/doctools.js?v=9bcbadda"></script>
      <script src="../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../../index.html" class="icon icon-home">
            Sidekick Python Library
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">API Reference:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../modules.html">sidekick</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Project Links:</span></p>
<ul>
<li class="toctree-l1"><a class="reference external" href="https://github.com/zhouer/Sidekick">GitHub Repository</a></li>
<li class="toctree-l1"><a class="reference external" href="https://pypi.org/project/sidekick-py/">PyPI Package</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">Sidekick Python Library</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="../index.html">Module code</a></li>
      <li class="breadcrumb-item active">sidekick.base_module</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <h1>Source code for sidekick.base_module</h1><div class="highlight"><pre>
<span></span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">Provides the foundational `BaseModule` class for all Sidekick visual modules.</span>

<span class="sd">This module defines the common blueprint used by other specific module classes</span>
<span class="sd">like `Grid`, `Console`, `Canvas`, etc. Think of it as the underlying engine</span>
<span class="sd">that handles tasks shared by all visual elements you create with Sidekick.</span>

<span class="sd">You typically won&#39;t use `BaseModule` directly in your scripts. Instead, you&#39;ll</span>
<span class="sd">work with the more specific classes (like `sidekick.Grid`). This base class</span>
<span class="sd">takes care of essential background tasks:</span>

<span class="sd">- Giving each module instance a unique ID (`target_id`).</span>
<span class="sd">- Making sure the connection to the Sidekick panel is active before sending commands.</span>
<span class="sd">- Providing helper methods (`_send_command`, `_send_update`) for sending</span>
<span class="sd">  instructions (like &quot;create&quot;, &quot;update&quot;, &quot;remove&quot;) to the Sidekick UI.</span>
<span class="sd">- Offering a standard way to remove the visual element (`remove()` method).</span>
<span class="sd">- Providing a way to handle errors reported by Sidekick for a specific module</span>
<span class="sd">  instance (`on_error` callback).</span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="kn">from</span><span class="w"> </span><span class="nn">.</span><span class="w"> </span><span class="kn">import</span> <span class="n">logger</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">.</span><span class="w"> </span><span class="kn">import</span> <span class="n">connection</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">.utils</span><span class="w"> </span><span class="kn">import</span> <span class="n">generate_unique_id</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">typing</span><span class="w"> </span><span class="kn">import</span> <span class="n">Optional</span><span class="p">,</span> <span class="n">Dict</span><span class="p">,</span> <span class="n">Any</span><span class="p">,</span> <span class="n">Callable</span>

<div class="viewcode-block" id="BaseModule">
<a class="viewcode-back" href="../../sidekick.html#sidekick.base_module.BaseModule">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">BaseModule</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Base class for all Sidekick module interface classes (like Grid, Console).</span>

<span class="sd">    This class manages the fundamental setup and communication logic needed</span>
<span class="sd">    for any Python object that represents a visual element in the Sidekick UI.</span>
<span class="sd">    It handles the creation of a unique ID, ensures the WebSocket connection</span>
<span class="sd">    is ready, sends commands, and provides common methods like `remove()` and</span>
<span class="sd">    `on_error()`.</span>

<span class="sd">    Note:</span>
<span class="sd">        This class is primarily for internal use by the library. You should use</span>
<span class="sd">        the specific subclasses like `sidekick.Grid`, `sidekick.Console`, etc.,</span>
<span class="sd">        in your code.</span>

<span class="sd">    Attributes:</span>
<span class="sd">        module_type (str): A string identifying the type of Sidekick module this</span>
<span class="sd">            class represents (e.g., &quot;grid&quot;, &quot;console&quot;). Used in communication.</span>
<span class="sd">        target_id (str): The unique identifier assigned to this specific module</span>
<span class="sd">            instance. This ID is used to route commands and events between</span>
<span class="sd">            the Python script and the correct UI element in Sidekick.</span>
<span class="sd">    &quot;&quot;&quot;</span>
<div class="viewcode-block" id="BaseModule.__init__">
<a class="viewcode-back" href="../../sidekick.html#sidekick.base_module.BaseModule.__init__">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">module_type</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">instance_id</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">spawn</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
        <span class="n">payload</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Initializes the base module, preparing it for interaction.</span>

<span class="sd">        This constructor is called automatically when you create an instance</span>
<span class="sd">        of a specific module class (e.g., `my_grid = sidekick.Grid()`).</span>
<span class="sd">        It sets up the unique ID, registers the instance with the connection</span>
<span class="sd">        manager so it can receive messages, and optionally sends the initial</span>
<span class="sd">        &#39;spawn&#39; command to create the visual element in the Sidekick UI.</span>

<span class="sd">        Args:</span>
<span class="sd">            module_type (str): The internal type name of the module (e.g., &quot;grid&quot;).</span>
<span class="sd">                This must match the type expected by the Sidekick UI.</span>
<span class="sd">            instance_id (Optional[str]): A user-provided ID for this module instance.</span>
<span class="sd">                - If `spawn` is True (creating a new element), this is optional.</span>
<span class="sd">                  If not provided, a unique ID will be generated automatically</span>
<span class="sd">                  (e.g., &quot;grid-1&quot;). Providing one allows you to reference this</span>
<span class="sd">                  specific instance later, perhaps from another script or context</span>
<span class="sd">                  (requires careful coordination).</span>
<span class="sd">                - If `spawn` is False (attaching to an existing element), this ID</span>
<span class="sd">                  is **required** and must match the ID of the element already</span>
<span class="sd">                  present in the Sidekick UI.</span>
<span class="sd">            spawn (bool): If True (the default), a &quot;spawn&quot; command is sent to</span>
<span class="sd">                Sidekick immediately to create the corresponding UI element.</span>
<span class="sd">                If False, the library assumes the UI element with the given</span>
<span class="sd">                `instance_id` already exists, and this Python object will simply</span>
<span class="sd">                &quot;attach&quot; to it to send commands or receive events.</span>
<span class="sd">            payload (Optional[Dict[str, Any]]): A dictionary containing the</span>
<span class="sd">                initial configuration data needed by the Sidekick UI to create</span>
<span class="sd">                the element (e.g., grid dimensions, console settings). This is</span>
<span class="sd">                only used if `spawn` is True. Keys in this dictionary should</span>
<span class="sd">                generally be `camelCase` to match the communication protocol.</span>

<span class="sd">        Raises:</span>
<span class="sd">            ValueError: If `spawn` is False but no `instance_id` was provided.</span>
<span class="sd">            SidekickConnectionError (or subclass): If the connection to Sidekick</span>
<span class="sd">                cannot be established when `activate_connection()` is called.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Ensure the connection is activated (blocks until ready or raises error).</span>
        <span class="c1"># This is crucial before registering handlers or sending commands.</span>
        <span class="n">connection</span><span class="o">.</span><span class="n">activate_connection</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">module_type</span> <span class="o">=</span> <span class="n">module_type</span>
        <span class="c1"># Initialize the placeholder for the user&#39;s error callback.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_error_callback</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Callable</span><span class="p">[[</span><span class="nb">str</span><span class="p">],</span> <span class="kc">None</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="c1"># Validate instance_id requirement when not spawning.</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">spawn</span> <span class="ow">and</span> <span class="n">instance_id</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;instance_id is required when spawn=False for module type &#39;</span><span class="si">{</span><span class="n">module_type</span><span class="si">}</span><span class="s2">&#39;&quot;</span><span class="p">)</span>

        <span class="c1"># Determine the final ID: use provided one or generate a new one.</span>
        <span class="c1"># Use generate_unique_id ONLY if spawning and no ID is given.</span>
        <span class="c1"># If not spawning, instance_id is guaranteed to be non-None here due to the check above.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">target_id</span> <span class="o">=</span> <span class="n">instance_id</span> <span class="k">if</span> <span class="n">instance_id</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="p">(</span><span class="n">generate_unique_id</span><span class="p">(</span><span class="n">module_type</span><span class="p">)</span> <span class="k">if</span> <span class="n">spawn</span> <span class="k">else</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">target_id</span><span class="p">:</span> <span class="c1"># Should not happen if logic above is correct</span>
             <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Could not determine target_id for </span><span class="si">{</span><span class="n">module_type</span><span class="si">}</span><span class="s2"> (spawn=</span><span class="si">{</span><span class="n">spawn</span><span class="si">}</span><span class="s2">, instance_id=</span><span class="si">{</span><span class="n">instance_id</span><span class="si">}</span><span class="s2">)&quot;</span><span class="p">)</span>


        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Initializing BaseModule: type=&#39;</span><span class="si">{</span><span class="n">module_type</span><span class="si">}</span><span class="s2">&#39;, id=&#39;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">target_id</span><span class="si">}</span><span class="s2">&#39;, spawn=</span><span class="si">{</span><span class="n">spawn</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="c1"># Register this instance&#39;s internal message handler with the connection manager.</span>
        <span class="c1"># This tells the connection manager to call self._internal_message_handler</span>
        <span class="c1"># whenever a message arrives from Sidekick with this instance&#39;s target_id</span>
        <span class="c1"># in the &#39;src&#39; field.</span>
        <span class="n">connection</span><span class="o">.</span><span class="n">register_message_handler</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">target_id</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_internal_message_handler</span><span class="p">)</span>

        <span class="c1"># If requested, send the initial command to create the UI element.</span>
        <span class="k">if</span> <span class="n">spawn</span><span class="p">:</span>
            <span class="c1"># Use the provided payload, or an empty dict if None.</span>
            <span class="c1"># Keys in the payload dictionary *must* be camelCase for the protocol.</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_send_command</span><span class="p">(</span><span class="s2">&quot;spawn&quot;</span><span class="p">,</span> <span class="n">payload</span> <span class="ow">or</span> <span class="p">{})</span></div>

        <span class="c1"># else: If not spawning, we just assume the UI element exists.</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_internal_message_handler</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">message</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Handles incoming messages specifically targeted at this module instance.</span>

<span class="sd">        This method is called automatically by the `connection` module&#39;s listener</span>
<span class="sd">        thread when a message arrives from the Sidekick UI where the message&#39;s</span>
<span class="sd">        `src` field matches this instance&#39;s `target_id`.</span>

<span class="sd">        It checks if the message is an &#39;error&#39; type and calls the registered</span>
<span class="sd">        `on_error` callback if available. Subclasses (like Grid, Console)</span>
<span class="sd">        override this method to add handling for &#39;event&#39; type messages (like</span>
<span class="sd">        clicks or text input) specific to their functionality.</span>

<span class="sd">        Args:</span>
<span class="sd">            message (Dict[str, Any]): The raw message dictionary received from</span>
<span class="sd">                the Sidekick connection manager.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">msg_type</span> <span class="o">=</span> <span class="n">message</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;type&quot;</span><span class="p">)</span>
        <span class="n">payload</span> <span class="o">=</span> <span class="n">message</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;payload&quot;</span><span class="p">)</span> <span class="c1"># Payload should contain camelCase keys.</span>

        <span class="k">if</span> <span class="n">msg_type</span> <span class="o">==</span> <span class="s2">&quot;error&quot;</span><span class="p">:</span>
            <span class="c1"># Attempt to extract the error message string from the payload.</span>
            <span class="n">error_message</span> <span class="o">=</span> <span class="s2">&quot;Unknown error received from Sidekick UI.&quot;</span>
            <span class="k">if</span> <span class="n">payload</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">payload</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;message&quot;</span><span class="p">),</span> <span class="nb">str</span><span class="p">):</span>
                <span class="n">error_message</span> <span class="o">=</span> <span class="n">payload</span><span class="p">[</span><span class="s2">&quot;message&quot;</span><span class="p">]</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Module &#39;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">target_id</span><span class="si">}</span><span class="s2">&#39; received error from Sidekick UI: </span><span class="si">{</span><span class="n">error_message</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="c1"># If the user registered an error handler, call it.</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_error_callback</span><span class="p">:</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_error_callback</span><span class="p">(</span><span class="n">error_message</span><span class="p">)</span>
                <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                    <span class="c1"># Catch errors within the user&#39;s callback to prevent crashing the listener.</span>
                    <span class="n">logger</span><span class="o">.</span><span class="n">exception</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error in </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">module_type</span><span class="si">}</span><span class="s2"> &#39;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">target_id</span><span class="si">}</span><span class="s2">&#39; on_error callback: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">msg_type</span> <span class="o">==</span> <span class="s2">&quot;event&quot;</span><span class="p">:</span>
            <span class="c1"># Base class doesn&#39;t handle specific events. Subclasses override this</span>
            <span class="c1"># method, check `payload[&#39;event&#39;]`, and call their specific callbacks.</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;BaseModule received unhandled event for &#39;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">target_id</span><span class="si">}</span><span class="s2">&#39;: </span><span class="si">{</span><span class="n">payload</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">pass</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># Log if we receive an unexpected message type targeted at this instance.</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Module &#39;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">target_id</span><span class="si">}</span><span class="s2">&#39; received unhandled message type &#39;</span><span class="si">{</span><span class="n">msg_type</span><span class="si">}</span><span class="s2">&#39;: </span><span class="si">{</span><span class="n">message</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<div class="viewcode-block" id="BaseModule.on_error">
<a class="viewcode-back" href="../../sidekick.html#sidekick.base_module.BaseModule.on_error">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">on_error</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">callback</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Callable</span><span class="p">[[</span><span class="nb">str</span><span class="p">],</span> <span class="kc">None</span><span class="p">]]):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Registers a function to call when Sidekick reports an error for this specific module.</span>

<span class="sd">        Sometimes, the Sidekick UI might encounter a problem related to this</span>
<span class="sd">        specific module (e.g., you tried to update a grid cell that doesn&#39;t</span>
<span class="sd">        exist). In such cases, the UI might send an &#39;error&#39; message back.</span>
<span class="sd">        This method lets you define a Python function (`callback`) that will</span>
<span class="sd">        be executed when such an error message is received.</span>

<span class="sd">        Args:</span>
<span class="sd">            callback (Optional[Callable[[str], None]]): The function to call</span>
<span class="sd">                when an error message arrives. This function should accept one</span>
<span class="sd">                argument: a string containing the error message from Sidekick.</span>
<span class="sd">                Pass `None` to remove any previously registered error handler.</span>

<span class="sd">        Raises:</span>
<span class="sd">            TypeError: If the provided `callback` is not a function (or None).</span>

<span class="sd">        Returns:</span>
<span class="sd">            None: This method sets up the callback but doesn&#39;t return anything.</span>

<span class="sd">        Examples:</span>
<span class="sd">            &gt;&gt;&gt; def my_grid_error_handler(message):</span>
<span class="sd">            ...     print(f&quot;Oh no, the grid reported an error: {message}&quot;)</span>
<span class="sd">            ...</span>
<span class="sd">            &gt;&gt;&gt; my_grid = sidekick.Grid()</span>
<span class="sd">            &gt;&gt;&gt; my_grid.on_error(my_grid_error_handler)</span>
<span class="sd">            &gt;&gt;&gt;</span>
<span class="sd">            &gt;&gt;&gt; # Later, to remove the handler:</span>
<span class="sd">            &gt;&gt;&gt; my_grid.on_error(None)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">callback</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="ow">not</span> <span class="nb">callable</span><span class="p">(</span><span class="n">callback</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;The provided on_error callback must be a callable function or None.&quot;</span><span class="p">)</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Setting on_error callback for module &#39;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">target_id</span><span class="si">}</span><span class="s2">&#39;.&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_error_callback</span> <span class="o">=</span> <span class="n">callback</span></div>


    <span class="k">def</span><span class="w"> </span><span class="nf">_send_command</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">msg_type</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">payload</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Internal helper to build and send a command message to Sidekick.</span>

<span class="sd">        This method constructs the standard message dictionary structure required</span>
<span class="sd">        by the communication protocol and then uses the `connection.send_message`</span>
<span class="sd">        function to actually send it over the WebSocket. `connection.send_message`</span>
<span class="sd">        handles ensuring the connection is ready and potential errors.</span>

<span class="sd">        Args:</span>
<span class="sd">            msg_type (str): The type of command (e.g., &quot;spawn&quot;, &quot;update&quot;, &quot;remove&quot;).</span>
<span class="sd">            payload (Optional[Dict[str, Any]]): The data payload associated with</span>
<span class="sd">                the command. **Keys within this payload dictionary should be</span>
<span class="sd">                `camelCase`** to match the protocol expected by the Sidekick UI.</span>
<span class="sd">                Defaults to None if no payload is needed.</span>

<span class="sd">        Raises:</span>
<span class="sd">            SidekickConnectionError (or subclass): If the connection is not ready</span>
<span class="sd">                or if sending the message fails.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">message</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="c1"># Reserved for future use, currently 0.</span>
            <span class="s2">&quot;module&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">module_type</span><span class="p">,</span> <span class="c1"># e.g., &quot;grid&quot;, &quot;console&quot;</span>
            <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="n">msg_type</span><span class="p">,</span>           <span class="c1"># e.g., &quot;spawn&quot;, &quot;update&quot;</span>
            <span class="s2">&quot;target&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">target_id</span><span class="p">,</span>   <span class="c1"># Identifies which UI element this command is for.</span>
            <span class="c1"># &quot;src&quot; is not needed when sending commands from Python to UI.</span>
        <span class="p">}</span>
        <span class="c1"># Only include the payload field in the JSON if it&#39;s provided.</span>
        <span class="k">if</span> <span class="n">payload</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">message</span><span class="p">[</span><span class="s2">&quot;payload&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">payload</span>

        <span class="c1"># Delegate the actual sending (and connection readiness check)</span>
        <span class="c1"># to the connection module.</span>
        <span class="n">connection</span><span class="o">.</span><span class="n">send_message</span><span class="p">(</span><span class="n">message</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_send_update</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">payload</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Convenience method for sending an &#39;update&#39; command with the given payload.</span>

<span class="sd">        This is simply a shortcut for `_send_command(&quot;update&quot;, payload)`.</span>

<span class="sd">        Args:</span>
<span class="sd">            payload (Dict[str, Any]): The payload for the update command. Keys</span>
<span class="sd">                within this dictionary should be `camelCase`.</span>

<span class="sd">        Raises:</span>
<span class="sd">            SidekickConnectionError (or subclass): If the connection is not ready</span>
<span class="sd">                or if sending the message fails.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Assume payload always exists for updates</span>
        <span class="k">if</span> <span class="n">payload</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Module &#39;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">target_id</span><span class="si">}</span><span class="s2">&#39; _send_update called with None payload.&quot;</span><span class="p">)</span>
            <span class="n">payload</span> <span class="o">=</span> <span class="p">{}</span> <span class="c1"># Send empty payload instead? Or raise? Sending empty for now.</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_send_command</span><span class="p">(</span><span class="s2">&quot;update&quot;</span><span class="p">,</span> <span class="n">payload</span><span class="p">)</span>

<div class="viewcode-block" id="BaseModule.remove">
<a class="viewcode-back" href="../../sidekick.html#sidekick.base_module.BaseModule.remove">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">remove</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Removes this module instance from the Sidekick UI and cleans up resources.</span>

<span class="sd">        This performs two main actions:</span>
<span class="sd">        1. Sends a &#39;remove&#39; command to the Sidekick UI, telling it to delete</span>
<span class="sd">           the visual element associated with this Python object.</span>
<span class="sd">        2. Cleans up internal resources in the Python library associated with</span>
<span class="sd">           this instance, such as unregistering message handlers and resetting</span>
<span class="sd">           any user-defined callbacks (like `on_click` or `on_error`).</span>

<span class="sd">        After calling `remove()`, you should generally not interact with this</span>
<span class="sd">        module object anymore.</span>

<span class="sd">        Returns:</span>
<span class="sd">            None: This method initiates removal but doesn&#39;t return anything.</span>

<span class="sd">        Examples:</span>
<span class="sd">            &gt;&gt;&gt; my_grid = sidekick.Grid()</span>
<span class="sd">            &gt;&gt;&gt; # ... use the grid ...</span>
<span class="sd">            &gt;&gt;&gt; my_grid.remove() # Remove the grid from the UI</span>
<span class="sd">            &gt;&gt;&gt;</span>
<span class="sd">            &gt;&gt;&gt; my_console = sidekick.Console()</span>
<span class="sd">            &gt;&gt;&gt; # ... use the console ...</span>
<span class="sd">            &gt;&gt;&gt; my_console.remove() # Remove the console</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Requesting removal of module &#39;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">target_id</span><span class="si">}</span><span class="s2">&#39;.&quot;</span><span class="p">)</span>

        <span class="c1"># 1. Unregister the handler so we don&#39;t process messages for a removed module.</span>
        <span class="n">connection</span><span class="o">.</span><span class="n">unregister_message_handler</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">target_id</span><span class="p">)</span>

        <span class="c1"># 2. Reset local callbacks defined in this base class.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_error_callback</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="c1"># 3. Give subclasses a chance to reset their specific callbacks.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_reset_specific_callbacks</span><span class="p">()</span>

        <span class="c1"># 4. Send the &#39;remove&#39; command to the Sidekick UI.</span>
        <span class="c1">#    This happens last, after internal cleanup. connection.send_message</span>
        <span class="c1">#    handles connection checks/errors.</span>
        <span class="k">try</span><span class="p">:</span>
             <span class="bp">self</span><span class="o">.</span><span class="n">_send_command</span><span class="p">(</span><span class="s2">&quot;remove&quot;</span><span class="p">)</span> <span class="c1"># Payload is typically None/omitted for remove</span>
        <span class="k">except</span> <span class="n">connection</span><span class="o">.</span><span class="n">SidekickConnectionError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
             <span class="c1"># Log if sending remove command fails, but don&#39;t crash the removal process.</span>
             <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Failed to send remove command for &#39;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">target_id</span><span class="si">}</span><span class="s2">&#39;: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">. &quot;</span>
                            <span class="sa">f</span><span class="s2">&quot;Internal cleanup still performed.&quot;</span><span class="p">)</span></div>



    <span class="k">def</span><span class="w"> </span><span class="nf">_reset_specific_callbacks</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Internal placeholder for subclasses to reset their unique callbacks.</span>

<span class="sd">        This method is called by the public `remove()` method. Subclasses</span>
<span class="sd">        (like `Grid`, `Console`, `Control`) should override this method to</span>
<span class="sd">        set their specific callback attributes (e.g., `_click_callback`,</span>
<span class="sd">        `_input_text_callback`) back to `None` during the removal process.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Base implementation does nothing, subclasses should override.</span>
        <span class="k">pass</span>

<div class="viewcode-block" id="BaseModule.__del__">
<a class="viewcode-back" href="../../sidekick.html#sidekick.base_module.BaseModule.__del__">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="fm">__del__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Attempt to unregister the message handler when the object is garbage collected.</span>

<span class="sd">        This is intended as a fallback safety measure. It tries to clean up the</span>
<span class="sd">        message handler registration if the object is deleted without `remove()`</span>
<span class="sd">        being called explicitly.</span>

<span class="sd">        Warning:</span>
<span class="sd">            Relying on `__del__` for cleanup is generally discouraged in Python</span>
<span class="sd">            as its execution timing is not guaranteed. You should **always try</span>
<span class="sd">            to call the `remove()` method explicitly** when you are finished</span>
<span class="sd">            with a Sidekick module instance.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="c1"># Check if the connection module and its function still exist,</span>
            <span class="c1"># as they might be gone during interpreter shutdown.</span>
            <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">connection</span><span class="p">,</span> <span class="s1">&#39;unregister_message_handler&#39;</span><span class="p">):</span>
                 <span class="n">connection</span><span class="o">.</span><span class="n">unregister_message_handler</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">target_id</span><span class="p">)</span>
                 <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;BaseModule __del__ unregistering handler for </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">target_id</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
            <span class="c1"># Suppress errors during __del__ as per standard practice.</span>
            <span class="k">pass</span></div>
</div>

</pre></div>

           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2025, Enjan Chou.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>